#!/usr/bin/env ruby

require "bundler/setup"
require "overt"
require "thor"
require "formatador"
require "pry"


class OvertCommand < Thor  
  include Overt::ConsoleOutput
  
  def self.exit_on_failure?
    true
  end

  desc "clean", "Remove all files in OVERT_BUILD_DIR"
  def clean
    print_command_header('clean')
    
    do_clean
  end
  
  desc "build", "Build the site, outputs to OVERT_BUILD_DIR"
  method_options :clean => :boolean
  def build
    print_command_header('build')
  
    f.display_table(Overt::Config.map { |k,v| 
      {
        config: k,
        value: Overt::Config[k]
      }
    })
    f.display_line("")
    
    if options[:clean]
      do_clean
    end
    
    results = Overt.build(f)
    f.display_line("")
    f.display_line("[green][bold]Built #{results.length} files[/]")
  end
  
  desc "v", "Prints version number"
  def v
    puts Overt::VERSION
  end
  
  private
  
  def do_clean
    f.display_line("[bold][red]Cleaning ./#{Pathname.new(Overt::Config[:build_dir])}[/]")
    f.display_line("")
    Overt.clean
  end
  
  def print_command_header(command)
    f.display_line("")
    f.display_line("ðŸ‘€ [bold][light_blue]overt #{command}[/] #{Overt::VERSION}")
    f.display_line("[light_black]------[/]")
    f.display_line("")
  end
  
end

OvertCommand.start
